package com.example.demo.service;

import java.util.List;
import java.util.Optional;

import org.springframework.stereotype.Service;

import com.example.demo.domain.ImgDTO;
import com.example.demo.domain.ProductDTO;
import com.example.demo.entity.Product;
import com.example.demo.repository.ProductDSLRespository;
import com.example.demo.repository.ProductRepository;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class ProductServiceImpl implements ProductService {

	private final ProductRepository prepository;
	private final ProductDSLRespository pdslRepository;

	@Override
	public List<Product> selectList() {

		return prepository.findAll();
	}

	@Override
	public List<ImgDTO> joinDSL() {
		return pdslRepository.joinDSL();
	}
	
	@Override
	public List<ImgDTO> joinDSLpage(int itemsPerPage, int currentPage, String inputValue, List<String> proCate, List<String> cateBrand) {
		
		
		if (proCate == null || proCate.isEmpty()) {
			if (cateBrand == null || cateBrand.isEmpty()) {
				return pdslRepository.joinDSLpage(itemsPerPage, currentPage, inputValue);
				
			}
			return pdslRepository.joinDSLpage(itemsPerPage, currentPage, inputValue, cateBrand);
		}
		if (cateBrand == null || cateBrand.isEmpty()) {
			return pdslRepository.joinDSLpage(itemsPerPage, currentPage, inputValue, proCate);
		}
		
		return pdslRepository.joinDSLpage(itemsPerPage, currentPage, inputValue, proCate);
	}
	
	// 전체 데이터 숫자 가져오기
	public Integer countAllProduct(String inputValue) {
		
		int maxproduct =  pdslRepository.countAllProduct(inputValue).intValue();
		
		return maxproduct;
		
	}
	
	// 상품에서 얼마나 많은 데이터를 가져올지에 대한 값
	public Integer countPerPage(int itemsPerPage, String inputValue) {
		
		int maxproduct = countAllProduct(inputValue);
		
		int maxpage = (int)Math.ceil((double)maxproduct / itemsPerPage);
		
		return maxpage;
		
	}
	
	
	
	
	
	
	
	@Override
	public List<String> findAllProIds() {
		return prepository.findAllProIds();
	}
	
	@Override
	public Product save(Product productEntity) {
		return prepository.save(productEntity);
	}
	@Override
	public Long update(Product productEntity, String proId) {
		return pdslRepository.update(productEntity, proId);
	}
	
	@Override
	public Product selectOne(String proId) {
		/*
		Optional<Product> result = prepository.findById(proId);
		if (result.isPresent()) {
			return result.get();
		}else {
			return null;
			
		}
		*/
		return pdslRepository.selectOneDSL(proId);
		
	}
	
	@Override
	public void deleteById(String proId) {
		prepository.deleteById(proId);
	}
	
	@Override
	public List<ImgDTO> searchList(String productname) {
		// TODO Auto-generated method stub
		return pdslRepository.searchList(productname);
	}
	

}
